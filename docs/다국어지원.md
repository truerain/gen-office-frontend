# 다국어 지원(i18n) 가이드

이 문서는 백엔드 i18n 사양과 `apps/demo`에서의 프론트 적용 방안을 정리합니다.

## 백엔드 i18n 규칙

- 메시지 리소스는 DB `tb_cm_message`에 저장
- 키는 `(namespace, message_cd, lang_cd)` 조합
- 로케일 결정 우선순위
  1. `X-Lang` 헤더
  2. `Accept-Language`
  3. (추후) 사용자 언어 설정
  4. 기본값 `ko`
- 응답 헤더에 `Content-Language`가 항상 내려옴

## 에러 응답 포맷

```json
{
  "code": "NOT_FOUND",
  "messageKey": "user.not_found",
  "message": "사용자를 찾을 수 없습니다",
  "locale": "ko",
  "path": "/api/users/1",
  "timestamp": "2026-02-09T09:12:34+09:00",
  "traceId": null
}
```

## 프론트 적용 가이드

- API 호출 시 로케일을 `X-Lang` 헤더로 전달 (예: `ko`, `en`, `en-US`)
- 에러 표시 시 `message`를 우선 사용하고, 필요 시 `messageKey`로 클라이언트 i18n fallback
- 응답 헤더 `Content-Language`로 서버 적용 로케일 확인 가능

현재 정의된 메시지 키
- `user.not_found`
- `menu.not_found`
- `common.internal_error`

## apps/demo 구현 포인트

### 1) 공통 HTTP 래퍼에서 헤더 주입

파일: `apps/demo/src/shared/api/http.ts`
- 모든 요청에 `X-Lang` 추가
- 응답 헤더에서 `Content-Language` 읽기
- 에러 응답 JSON을 파싱해 `message` 우선 적용

### 2) i18n 현재 로케일 제공

파일: `apps/demo/src/i18n/index.ts`
- 현재 로케일을 반환하는 `getCurrentLocale()` 추가
- `http.ts`에서 사용해 `X-Lang` 주입

### 3) 에러 메시지 처리

- 에러 객체에 `messageKey`, `code`, `locale` 등 메타를 보관
- 화면에서는 `message` 우선 표시
- `message`가 비었을 때만 `messageKey`로 `t(...)` fallback

### 4) 로컬 번들 최소 키 추가

파일:
- `apps/demo/src/i18n/locales/ko/common.json`
- `apps/demo/src/i18n/locales/en/common.json`

추가 필요 키:
- `user.not_found`
- `menu.not_found`
- `common.internal_error`

## 전역 알림(Global Notification) 사용법

앱 전역 알림은 `zustand` 스토어로 제공됩니다.

스토어 위치:
- `apps/demo/src/app/store/appStore.ts`

사용 예시:

```ts
import { useAppStore } from '@/app/store/appStore';

const addNotification = useAppStore((state) => state.addNotification);

// 성공 알림
addNotification('저장되었습니다.', 'success');

// 에러 알림
addNotification('요청에 실패했습니다.', 'error');
```

권장 정책:
- 서버 에러는 전역 알림으로 통일
- 단발성 안내는 `info`, 실패는 `error`, 성공은 `success` 사용
